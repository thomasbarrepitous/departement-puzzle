<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
  <title>Map</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsvectormap/dist/css/jsvectormap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsvectormap"></script>
  <script src="/js/map.js"></script>
  <script src="/js/codes.js"></script>
  <script src="/js/game.js"></script>
  <script>
        var gameObs = new GameObserver(stateMap);
        const map = new jsVectorMap({
            selector: "#map",
            map: "france_departments",
            showTooltip: false,
            draggable: false,
            zoomOnScroll: false,
            zoomButtons: false,
            panOnDrag: false,
            backgroundColor: "#fff",
            onRegionClick: function (event, code) {
                const map = gameObs.game.codeToNameMap;
                const clickedDep = getDepartementFromCode(map, code);
                if (gameObs.game.isRunning === false) {
                    return;
                }
                if (code === map[gameObs.game.currentDepartement].code) {
                    event.srcElement.style.fill = "green";
                    console.log("Correct department, you clicked on : " + clickedDep.name);
                    gameObs.next();
                } else {
                    event.srcElement.style.fill = "red";
                    console.log("Wrong department, you clicked on : " + clickedDep.name);
                }
                if (gameObs.game.departementStack.length === 0) {
                    gameObs.stop();
                    console.log("You won!");
                }
            },
        });
  </script>
  <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        #map {
            width: 70%;
            height: 70%;
            background-color: #ddd;
        }
  </style>
</head>
<body hx-target="#body" hx-swap="outerHTML">
  <div id="timerDisplay" hx-target="#timerDisplay" hx-swap="outerHTML">
    Timer: 00:00
  </div>
  <div id="departementDisplay" hx-target="#departementDisplay" hx-swap="outerHTML">
    Department:
  </div>
  <div id="map" hx-target="#map" hx-swap="outerHTML"></div>
  <div class="navbar" hx-target="#navbar" hx-swap="outerHTML">
    <button id="toggleGameButton" class="button" onclick="toggleButton(this, gameObs)">Start</button>
  </div>
</body>
</html>
